# 보안 HTTP
> 디지털 암호화를 이용해 도청이나 위조로부터 HTTP 트랜잭션을 안전하게 보호하는 기술

### HTTP를 안전하게 만들기
- HTTP보안 버전은 효율적이고, 이식성이 좋아야 하고, 관리가 쉬어야 하며, 현실 세계의 변화에 대한 적응력이 좋아야 한다.

#### 1. HTTPS
- HTTPS는 HTTP의 하부에 보안 계층인 SSL혹은 TLS를 두어 요청 응답을 암호화하게 하는 방식

### 디지털 암호학

#### 비대칭키
- 공개키만 알면 누구나 서버에 안전하게 메시지를 보낼 수 있게 해준다.
- 허나 느리다.

#### 디지털 서명
- 메시지를 암호화하는 것 뿐만아니라 누가 메시지를 썼는지 알려주고 위조되지 않았음을 증명하는 것이 디지털 서명
- 체크섬을 이용한다.
- 서명을 통해 메시지 작성자를 알 수 있다.
- 저자는 극비 개인키를 가지고 저자만의 체크섬을 계산하여 개인 서명처럼 동작한다.
- 서명은 메시지 위조를 방지할 수 있다.
- 공격자가 메시지를 날조하면 체크섬은 더 이상 맞지 않게된다.

> 즉 개인키로 암호화해서 공개키로 풀게되면 해당 저자만이 개인키를 알고 있으므로 해당 저자인지 확신이 가능하다.

### 디지털 인증서
- 디지털인증서는 신뢰할 수 있는 기관으로부터의 보증받은 사용자에 대한 정보를 가지고 있다.

#### 인증서 내부
- 대상의 이름(사람, 서버, 조직)
- 유효 기간
- 인증서 발급자
- 인증서 발급자의 디지털 서명

#### 서버 인증을 위해 인증서 사용
- 사용자가 HTTPS를 통해 웹 트랜잭션을 시작할 때 최신 브라우저는 디지털 인증서를 가져온다.
- 만약 서버가 인증서를 가지고 있지 않다면 커넥션은 실패한다.

### HTTPS 세부사항
- HTTPS는 HTTP 프로토콜에 대칭, 비대칭 인증서 기반 암호 기법을 겳합한 것
- HTTPS는 그냥 보안 전송 계층을 통해 전송되는 HTTP이다.
- 암호화되지 않은 HTTP 메시지를 TCP를 통해 전세계의 인터넷으로 보내는 대신 TCP로 보내기전에 보안 계층에서 암호화하여 데이터를 보낸다.
- SSL 트래픽은 바이너리 프로톨콜이므로 HTTP와 다르다.
- 그렇기 떄문에 HTTPS는 443, HTTP는 80 포트로 보내야 한다.

#### 전송 흐름
> HTTP는 TCP 커넥션을 열고, 요청, 응답 후 커넥션을 닫지만 HTTPS는 더 복잡하다.

1. 443 포트로 TCP 커넥션을 수립한다.
2. SSL 보안 핸드셰이크 과정을 수행한다.
3. HTTP요청 시 SSL을 통해 암호화 하여 요청
4. HTTP응답 시 SSL을 통해 암호화 하여 응답
5. SSL 닫음 통지
6. 커넥션 닫힘

#### SSL 핸드셰이크
1. 클라이언트가 암호 후보들을 보내고 인증서를 서버에게 요구
2. 서버는 선택된 암호화 인증서를 클라이언트에게 응답
3. 클라이언트는 비밀정보를 보내고 클라이언트와 서버는 키를 만듬
4. 클라이언트와 서버는 서로에게 암호화를 시작한다고 알림.

#### 사이트 인증서 / 검사
> 웹 브라우저는 기본적인 인증서에 대해 검사를 한다.

- 날짜 검사
- 서명자 신뢰도 검사
- 서명 검사: 서명기관의 공개키를 서명에 적용해 무결성 확인
- 사이트 신원 검사: 도메인 이름을 비교하여 트래픽의 시누언 확인


### 프락시를 통한 보안 트래픽 터널링
- 클라이언트트 종종 웹 서버에 접근해주는 웹 프락시 서버를 이용 한다.
- 예를들어 많은 회사가 기업 네트워크와 public 인터넷을 잇는 경계에 보안을 위한 프락시를 설치한다.
- 이 프락시는 방화벽 라우터가 HTTP 트래픽의 교환을 허락하는 유일한 장치로 바이러스 검사나 기타 콘텐츠 제어를 수행한다.

> 만약 클라이언트가 공개키로 암호화 했다면 프락시는 HTTP 헤더를 읽을 수 없다.
그러면 프락시는 요청을 어디로 보내야할 지 모르게 된다.

- 이를 해결하기 위해 HTTPS SSL 터널링 프로토콜이 있다.
- 터널링 프로토콜을 이용해 클라이언트는 먼저 프락시에게 자신이 연결하고자 하는 안전한 호스트와 포트를 말해준다.
- 이내용은 프락시가 알 수있게 평문으로 보내준다.
